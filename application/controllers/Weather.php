<?php


class Weather extends CI_Controller {

    function __construct() {
        parent::__construct();
        $this->load->helper('url');
    }

    public function search(){
        if (isset($_POST['weather-search'])){
            $airport = $_POST['airport'];
            $this->db->like('name', $airport);
            $query = $this->db->get('airports');
            if($query->num_rows() > 0)
            {
                foreach($query->result_array() as $row)
                {
                    $icao = $row["icao"];
                }
            }
            else {
                redirect(base_url(),'refresh');
            }
            $date = $_POST['date'];
            $year = date("Y", strtotime($date));
            $mounth = date("m", strtotime($date));
            $day = date("d", strtotime($date));
//           $data['metar_data'] = file_get_contents("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=".$icao."&data=metar&year1=".$year."&month1=".$mounth."&day1=".$day."&year2=".$year."&month2=".$mounth."&day2=".$day."&hour1=00&hour2=02&tz=Etc%2FUTC&format=onlycomma&latlon=no&&direct=no&report_type=1&report_type=2",false);
//            $data['menu'] = $this->load->view('search',$data);
//            $this->load->view('index',$data);
            //$content = file_get_contents("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=".$icao."&data=metar&year1=".$year."&month1=".$mounth."&day1=".$day."&year2=".$year."&month2=".$mounth."&day2=".$day."&hour1=00&hour2=02&tz=Etc%2FUTC&format=onlycomma&latlon=no&&direct=no&report_type=1&report_type=2",false);
            $content = 'station,valid,metar
ALO,2019-08-01 00:00,KALO 010000Z AUTO 20005KT 10SM CLR 26/15 A3012 RMK T02600150 MADISHF
ALO,2019-08-01 00:05,KALO 010005Z AUTO 18005KT 10SM CLR 26/16 A3012 RMK T02600160 MADISHF
ALO,2019-08-01 00:10,KALO 010010Z AUTO 19005KT 10SM CLR 26/15 A3012 RMK T02600150 MADISHF
ALO,2019-08-01 00:15,KALO 010015Z AUTO 18004KT 10SM CLR 26/15 A3013 RMK T02600150 MADISHF
ALO,2019-08-01 00:20,KALO 010020Z AUTO 18004KT 10SM CLR 25/16 A3013 RMK T02500160 MADISHF
ALO,2019-08-01 00:25,KALO 010025Z AUTO 18005KT 10SM CLR 26/15 A3013 RMK T02600150 MADISHF
ALO,2019-08-01 00:30,KALO 010030Z AUTO 20004KT 10SM CLR 25/14 A3013 RMK T02500140 MADISHF
ALO,2019-08-01 00:35,KALO 010035Z AUTO 19004KT 10SM CLR 24/15 A3013 RMK T02400150 MADISHF
ALO,2019-08-01 00:40,KALO 010040Z AUTO 20004KT 10SM CLR 24/15 A3013 RMK T02400150 MADISHF
ALO,2019-08-01 00:45,KALO 010045Z AUTO 19004KT 10SM CLR 24/16 A3013 RMK T02400160 MADISHF
ALO,2019-08-01 00:50,KALO 010050Z AUTO 19002KT 10SM CLR 24/16 A3013 RMK T02400160 MADISHF
ALO,2019-08-01 00:54,KALO 010054Z 19003KT 10SM CLR 24/16 A3014 RMK AO2 SLP202 T02440156
ALO,2019-08-01 00:55,KALO 010055Z AUTO 18002KT 10SM CLR 24/16 A3013 RMK T02400160 MADISHF
ALO,2019-08-01 01:00,KALO 010100Z AUTO 18002KT 10SM CLR 24/16 A3013 RMK T02400160 MADISHF
ALO,2019-08-01 01:05,KALO 010105Z AUTO 18002KT 10SM CLR 24/15 A3013 RMK T02400150 MADISHF
ALO,2019-08-01 01:10,KALO 010110Z AUTO 18002KT 10SM CLR 24/15 A3012 RMK T02400150 MADISHF
ALO,2019-08-01 01:15,KALO 010115Z AUTO 18002KT 10SM CLR 24/14 A3012 RMK T02400140 MADISHF
ALO,2019-08-01 01:20,KALO 010120Z AUTO 18002KT 10SM CLR 25/14 A3012 RMK T02500140 MADISHF
ALO,2019-08-01 01:25,KALO 010125Z AUTO 18002KT 10SM CLR 24/14 A3012 RMK T02400140 MADISHF
ALO,2019-08-01 01:30,KALO 010130Z AUTO 18002KT 10SM CLR 24/14 A3012 RMK T02400140 MADISHF
ALO,2019-08-01 01:35,KALO 010135Z AUTO 00000KT 10SM CLR 24/14 A3012 RMK T02400140 MADISHF
ALO,2019-08-01 01:40,KALO 010140Z AUTO 15002KT 10SM CLR 24/14 A3012 RMK T02400140 MADISHF
ALO,2019-08-01 01:45,KALO 010145Z AUTO 07005KT 10SM CLR 23/15 A3012 RMK T02300150 MADISHF
ALO,2019-08-01 01:50,KALO 010150Z AUTO 06005KT 10SM CLR 21/17 A3012 RMK T02100170 MADISHF
ALO,2019-08-01 01:54,KALO 010154Z AUTO 08005KT 10SM CLR 21/17 A3013 RMK AO2 SLP200 T02060167
ALO,2019-08-01 01:55,KALO 010155Z AUTO 08004KT 10SM CLR 21/17 A3012 RMK T02100170 MADISHF
ALO,2019-08-01 02:00,KALO 010200Z AUTO 08005KT 10SM CLR 21/17 A3012 RMK T02100170 MADISHF
ALO,2019-08-01 02:05,KALO 010205Z AUTO 08005KT 10SM CLR 20/16 A3012 RMK T02000160 MADISHF
ALO,2019-08-01 02:10,KALO 010210Z AUTO 08005KT 10SM CLR 20/16 A3012 RMK T02000160 MADISHF
ALO,2019-08-01 02:15,KALO 010215Z AUTO 08005KT 10SM CLR 20/16 A3012 RMK T02000160 MADISHF
ALO,2019-08-01 02:20,KALO 010220Z AUTO 08005KT 10SM CLR 19/16 A3012 RMK T01900160 MADISHF
ALO,2019-08-01 02:25,KALO 010225Z AUTO 08005KT 10SM CLR 19/16 A3012 RMK T01900160 MADISHF
ALO,2019-08-01 02:30,KALO 010230Z AUTO 08005KT 10SM CLR 19/16 A3012 RMK T01900160 MADISHF
ALO,2019-08-01 02:35,KALO 010235Z AUTO 09005KT 10SM CLR 19/16 A3012 RMK T01900160 MADISHF
ALO,2019-08-01 02:40,KALO 010240Z AUTO 09005KT 10SM CLR 19/16 A3012 RMK T01900160 MADISHF
ALO,2019-08-01 02:45,KALO 010245Z AUTO 09005KT 10SM CLR 19/16 A3012 RMK T01900160 MADISHF
ALO,2019-08-01 02:50,KALO 010250Z AUTO 10005KT 10SM CLR 19/16 A3012 RMK T01900160 MADISHF
ALO,2019-08-01 02:54,KALO 010254Z AUTO 10005KT 10SM CLR 20/16 A3014 RMK AO2 SLP202 T02000156 51002
ALO,2019-08-01 02:55,KALO 010255Z AUTO 10005KT 10SM CLR 20/16 A3013 RMK T02000160 MADISHF
ALO,2019-08-01 03:00,KALO 010300Z AUTO 10005KT 10SM CLR 19/16 A3013 RMK T01900160 MADISHF
ALO,2019-08-01 03:05,KALO 010305Z AUTO 10004KT 10SM CLR 19/16 A3013 RMK T01900160 MADISHF
ALO,2019-08-01 03:10,KALO 010310Z AUTO 00000KT 10SM CLR 19/16 A3013 RMK T01900160 MADISHF
ALO,2019-08-01 03:15,KALO 010315Z AUTO 00000KT 10SM CLR 19/16 A3013 RMK T01900160 MADISHF
ALO,2019-08-01 03:20,KALO 010320Z AUTO 00000KT 10SM CLR 19/16 A3013 RMK T01900160 MADISHF
ALO,2019-08-01 03:25,KALO 010325Z AUTO 00000KT 10SM CLR 19/16 A3013 RMK T01900160 MADISHF
ALO,2019-08-01 03:30,KALO 010330Z AUTO 00000KT 10SM CLR 19/16 A3013 RMK T01900160 MADISHF
ALO,2019-08-01 03:35,KALO 010335Z AUTO 00000KT 10SM CLR 19/16 A3013 RMK T01900160 MADISHF
ALO,2019-08-01 03:40,KALO 010340Z AUTO 00000KT 10SM CLR 19/16 A3013 RMK T01900160 MADISHF
ALO,2019-08-01 03:45,KALO 010345Z AUTO 00000KT 10SM CLR 19/16 A3013 RMK T01900160 MADISHF
ALO,2019-08-01 03:50,KALO 010350Z AUTO 00000KT 10SM CLR 18/15 A3013 RMK T01800150 MADISHF
ALO,2019-08-01 03:54,KALO 010354Z AUTO 00000KT 10SM CLR 18/15 A3014 RMK AO2 SLP203 T01830150
ALO,2019-08-01 03:55,KALO 010355Z AUTO 00000KT 10SM CLR 18/15 A3013 RMK T01800150 MADISHF
ALO,2019-08-01 04:00,KALO 010400Z AUTO 00000KT 10SM CLR 18/15 A3013 RMK T01800150 MADISHF
ALO,2019-08-01 04:05,KALO 010405Z AUTO 00000KT 10SM CLR 18/15 A3013 RMK T01800150 MADISHF
ALO,2019-08-01 04:10,KALO 010410Z AUTO 00000KT 10SM CLR 18/15 A3013 RMK T01800150 MADISHF
ALO,2019-08-01 04:15,KALO 010415Z AUTO 00000KT 10SM CLR 18/15 A3013 RMK T01800150 MADISHF
ALO,2019-08-01 04:20,KALO 010420Z AUTO 11002KT 10SM CLR 18/15 A3012 RMK T01800150 MADISHF
ALO,2019-08-01 04:25,KALO 010425Z AUTO 11002KT 10SM CLR 18/15 A3012 RMK T01800150 MADISHF
ALO,2019-08-01 04:30,KALO 010430Z AUTO 10002KT 10SM CLR 18/15 A3013 RMK T01800150 MADISHF
ALO,2019-08-01 04:35,KALO 010435Z AUTO 11002KT 10SM CLR 18/14 A3012 RMK T01800140 MADISHF
ALO,2019-08-01 04:40,KALO 010440Z AUTO 11002KT 10SM CLR 17/14 A3012 RMK T01700140 MADISHF
ALO,2019-08-01 04:45,KALO 010445Z AUTO 12002KT 10SM CLR 18/14 A3013 RMK T01800140 MADISHF
ALO,2019-08-01 04:50,KALO 010450Z AUTO 10002KT 10SM CLR 18/14 A3013 RMK T01800140 MADISHF
ALO,2019-08-01 04:54,KALO 010454Z AUTO 09003KT 10SM CLR 18/14 A3014 RMK AO2 SLP202 T01780144
ALO,2019-08-01 04:55,KALO 010455Z AUTO 09002KT 10SM CLR 18/14 A3013 RMK T01800140 MADISHF
ALO,2019-08-01 05:00,KALO 010500Z AUTO 09002KT 10SM CLR 18/14 A3013 RMK T01800140 MADISHF
ALO,2019-08-01 05:05,KALO 010505Z AUTO 08002KT 10SM CLR 17/14 A3013 RMK T01700140 MADISHF
ALO,2019-08-01 05:10,KALO 010510Z AUTO 06002KT 10SM CLR 17/14 A3013 RMK T01700140 MADISHF
ALO,2019-08-01 05:15,KALO 010515Z AUTO 00000KT 10SM CLR 17/14 A3014 RMK T01700140 MADISHF
ALO,2019-08-01 05:20,KALO 010520Z AUTO 00000KT 10SM CLR 18/14 A3014 RMK T01800140 MADISHF
ALO,2019-08-01 05:25,KALO 010525Z AUTO 07002KT 10SM CLR 18/14 A3014 RMK T01800140 MADISHF
ALO,2019-08-01 05:30,KALO 010530Z AUTO 07002KT 10SM CLR 17/14 A3014 RMK T01700140 MADISHF
ALO,2019-08-01 05:35,KALO 010535Z AUTO 08002KT 10SM CLR 17/14 A3014 RMK T01700140 MADISHF
ALO,2019-08-01 05:40,KALO 010540Z AUTO 07002KT 10SM CLR 17/14 A3014 RMK T01700140 MADISHF
ALO,2019-08-01 05:45,KALO 010545Z AUTO 07002KT 10SM CLR 17/14 A3014 RMK T01700140 MADISHF
ALO,2019-08-01 05:50,KALO 010550Z AUTO 00000KT 10SM CLR 17/14 A3014 RMK T01700140 MADISHF
ALO,2019-08-01 05:54,KALO 010554Z AUTO 00000KT 10SM CLR 17/14 A3015 RMK AO2 SLP206 T01720144 10256 20167 402720117 53005
ALO,2019-08-01 05:55,KALO 010555Z AUTO 00000KT 10SM CLR 17/14 A3014 RMK T01700140 MADISHF
ALO,2019-08-01 06:00,KALO 010600Z AUTO 05004KT 10SM CLR 17/14 A3014 RMK T01700140 MADISHF
ALO,2019-08-01 06:05,KALO 010605Z AUTO 00000KT 10SM CLR 17/14 A3014 RMK T01700140 MADISHF
ALO,2019-08-01 06:10,KALO 010610Z AUTO 07002KT 10SM CLR 17/14 A3015 RMK T01700140 MADISHF
ALO,2019-08-01 06:15,KALO 010615Z AUTO 08002KT 10SM CLR 17/14 A3014 RMK T01700140 MADISHF
ALO,2019-08-01 06:20,KALO 010620Z AUTO 07002KT 10SM CLR 17/14 A3015 RMK T01700140 MADISHF
ALO,2019-08-01 06:25,KALO 010625Z AUTO 08004KT 10SM CLR 17/14 A3015 RMK T01700140 MADISHF
ALO,2019-08-01 06:30,KALO 010630Z AUTO 07005KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 06:35,KALO 010635Z AUTO 07005KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 06:40,KALO 010640Z AUTO 08004KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 06:45,KALO 010645Z AUTO 07004KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 06:50,KALO 010650Z AUTO 07004KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 06:54,KALO 010654Z AUTO 08003KT 10SM CLR 16/14 A3016 RMK AO2 SLP209 T01610139
ALO,2019-08-01 06:55,KALO 010655Z AUTO 07002KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 07:00,KALO 010700Z AUTO 07002KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 07:05,KALO 010705Z AUTO 06004KT 10SM CLR 16/13 A3015 RMK T01600130 MADISHF
ALO,2019-08-01 07:10,KALO 010710Z AUTO 07004KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 07:15,KALO 010715Z AUTO 07004KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 07:20,KALO 010720Z AUTO 07002KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 07:25,KALO 010725Z AUTO 07002KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 07:30,KALO 010730Z AUTO 07002KT 10SM CLR 16/14 A3014 RMK T01600140 MADISHF
ALO,2019-08-01 07:35,KALO 010735Z AUTO 06002KT 10SM CLR 16/14 A3014 RMK T01600140 MADISHF
ALO,2019-08-01 07:40,KALO 010740Z AUTO 00000KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 07:45,KALO 010745Z AUTO 05002KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 07:50,KALO 010750Z AUTO 03002KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 07:54,KALO 010754Z AUTO 03003KT 10SM CLR 16/14 A3016 RMK AO2 SLP209 T01610139
ALO,2019-08-01 07:55,KALO 010755Z AUTO 03002KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 08:00,KALO 010800Z AUTO 03002KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 08:05,KALO 010805Z AUTO 00000KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 08:10,KALO 010810Z AUTO 00000KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 08:15,KALO 010815Z AUTO 00000KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 08:20,KALO 010820Z AUTO 00000KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF
ALO,2019-08-01 08:25,KALO 010825Z AUTO 00000KT 10SM CLR 16/14 A3015 RMK T01600140 MADISHF';
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment; filename="sample.csv"');
            $data = array($content);
            $fp = fopen('php://output', 'wb');
            foreach ( $data as $line ) {
                $val = explode(",", $line);
                fputcsv($fp, $val);
            }
            fclose($fp);
        }
    }
}
